# 데이터 분석 심화 첫 시간

## TCT

티씨티에서 문제에 대해서는

문제 상황에 대해 충분히 이해를 하고 -> 투비 이미지를 그리는 것에 집중적으로 답변을 적어야 함. 

(알고리즘 위주 x 딥러닝 어쩌고 x)

어떤게 문제인지 파악을 하고 -> 어떤 식으로 접근하면 좋을지에 대한 것을 서술 하고 -> 이후 적용 단까지 종합적으로 A부터 Z까지를 고려하여 답변을 적어야 함. 

답변을 길게, 알고리즘에 대해서 충실하게 답변을 모두 적어도 분석 과제의 to-be이미지를 제대로 그리지 못하면 점수를 잘 줄 수 없음.

 

## 본 교육 - 오전

### 분석 프로세스 및 to-be 프로세스

세부적인 문제정의?

-> 문제가 간헐적으로 발생하고 있는지 ,한번 발생했는데 큰 규모인지, 문제가 점점 커져 갈 것인지에 대한 문제가 발생하는 주기부터,  불량률을 detect하고 싶은 것인지, 불량 예측을 하려는 것인지에 대한 구체적인 문제 정의. 

가설수립까지 진행하고 나서는 바로 모델링을 진행하는 것이 아니라 to-be이미지를 정의하여야 함. 해당 to-be이미지를 가장 잘 그릴 수 있기 위한 목적으로 알고리즘 방법론 정의가 시작 되는 것. 

EDA진행 전, 어떠한 관계성을 살펴보고 싶다를 미리 정한 뒤에 EDA를 하는 것이 좋음. 순서가 역이 되면 인사이트 발굴이 힘듬 (목적을 가지고 EDA를 하라)

모델링은 간단하고, 평가가 중요한데 평가 과정에서 학습 데이터는 10만건을 쓸지, 100만건을 쓸지 학습 주기는 어떻게 할지 등을 세부적으로 결정해야 하고, 평가 단에서 ~한 추가 데이터가 더 필요하고, 학습 데이터는 최소 00만건 필요하다 라는 것이 다 정의가 되면 현업 담당자와 협의 후 데이터를 추가 마련 하고, 이후 운영/배포/배치 등의 작업이 들어가야 함. 

또한, 대부분의 고객은 모델을 만들어서 넘겨준다 한들 그걸 운영 할 수 있는 역량과 환경이 안되기 때문에(알로 분석 진행했는데 알도 안깔려 있음 등등) 분석 환경 구축(?) 에 대한 논의가 반드시 필요함. (dap mldl을 추천하면 사용료 계속 받기 때문에 제일 좋음 / 그게 아니더라도 어느정도 데이터와 모델이 돌아갈 수 있을 만한 사양의 분석 환경 구축 필요)

to-be이미지?

이상탐지를 한다고 하면 단순히 알고리즘을 생각하는것이 아니라, 이상이 탐지되고 나서 이상요인을 도출하고 나면 그것을 email로 알려줄지, sms로 알려줄지 등 모든 일련의 과정을 다 고려하는 것이 to-be이미지 프로세스임. 



### 데이터 타입

1. 시간별, 개체별 데이터 

   - 유플러스 같이 멤버십 데이터를 가지고 있는 기업들의 데이터가 주로 이에 해당. 

     -> 한 개체(한 사람) 에 대해서는 시간순에 따라 자기상관성이 존재하게 됨. ID가 관측개체일때, 동일 ID에 대해서는 관측치 간에 correlation이 강함. 

     -> 그러나 머신러닝 모델을 일반적으로 적용할때에는, 관측치 간에 독립성이 요구되는 경우가 많음. 따라서 추론의 단위를 독립으로 맞추어 주어야 함. 즉, 관측개체인 ID를 하나의 row로 처리 하여야 함. 

     -> 그러나 사람마다 데이터 이용 기간이라던지, 멤버십 이용 기간이 다르기 때문에 필연적으로 결측치가 발생하게 됨. 

     -> 기존의 달에 대한 정보를 없애고, 특정 해지 시점의 직전/직후 정보를 활용한다고 하면 위와 같은 문제점을 해결 할 수 있음. (3월컬럼, 4월컬럼이 아니라 해지 시점의 2시점 전, 1시점 전)

   - LGIT 카메라모듈 생산 데이터도 해당 데이터 형식임.

     -> 이 데이터 역시 모델링을 위해서는 제품 ID가 각각 row로 들어가게끔 wide_form으로 데이터 형식을 변환 해 주어야 함. (동일한 제품 ID에 대해서는 공정이나 설비 변수에 대해 자기상관이 반드시 존재하기 때문)

2. 시계열 데이터

   - 특정 관측 개체가 존재하는 것이 아닌, 시간의 흐름에 따라 그냥 쭉 조사가 된 데이터임. (제조 생산, 품질 데이터 등등)

   - 각 인자(각 변수)가 조사되는 시점이 서로 다를 수 있다는 특징이 있음. 

     -> 결측이 존재할 수 있는데, 이를 방지하기 위해 TimeFrame(1분단위, 5분단위 등등) 을 분석가가 다시 정의해야 할 수 있음. 그래서 한 timeframe에 관측값이 여러개일 수 있고, 그럴때 median값을 넣는다던지 등의 대표값을 이용하여 데이터마트를 구성해야 함. 

     -> 모든 컬럼에 대해서 자기상관이 존재한다는 특징이 있음(행간 독립이 하나도없음.) 따라서 독립성을 만들기 위해서 3분단위로 평균값을 만든다던지 하는 방식을 주로 사용.

     -> 즉 data sumamry를 두번 하는 것임. 일차적으로 timeframe을 선정해서 데이터마트를 구성하고, 해당 데이터마트에서 행간의 독립성을 최대한 가져가기 위해 time frame을 한번 더 구성해서 머신러닝 모델링용 데이터마트를 또 구성함. 

   - 특히, 공정 데이터에서 동일 제품의 상태를 모델링 하기 위해서는 공정간 시차를 고려하여 재병합 하는 과정이 필요함. 

     -> tag1 -> tag2 간에 한시간 차이가 난다고 하면, 특정 시점에서 두가지 공정 데이터를 모두 사용하고자 한다면 1시간의 타임gap을 고려하여야 함. 

3. 공간(시계열) 데이터

   - 위도 경도 등의 데이터가 이에 해당. 통신사 기지국 데이터, 신용카드 가맹점 데이터, 가스 검출기 데이터 등등이 해당하며 가까운 위치의 값은 서로 유사함을 가정함. (시계열 데이터의 2차원 버전!)  




## 본 교육-오후

### 예측/ 분류모형

1. 시계열 예측모형 

   시계열/non시계열에서 데이터 형태를 wide-form으로 변환 후 모델링 진행 하는 것을 추천. 

   - 고려할 점 1

     고려해야 할 것은 dependency가 어디에 존재하느냐인데, long form 형태를 wide form으로 바꾸어서 row간의 독립성을 어느정도 보장하게 되면, row 순서가 변경되어도 관계가 없어지므로 데이터 셔플 역시 가능 해 지고, train valid test 분할 시 time dependency를 고려하지 않아도 됨. 

     시계열 모델을 사용하지 않는 경우, 예측하고자 하는 시점과 예측값이 필요한 시점간의 시차만큼 y변수와 x변수 간의 시차를 두어야 함. 

     시계열 모델의 결과처럼 미래 여러시점(t+1, t+2,..t+h)의 예측결과를 시계열모델이 아닌 지도학습 모델로 예측하기 위해서는 예측시점의 개수만큼 (h) 모델을 학습해야 함. 

   - 고려할 점 2 - column dependency는 어떻게 해결해야 하는가? 

     선형 회귀의 분석에는 다중공산성이라는 문제가 생기지만, 예측모형일 경우에는 크게 x간의 독립성을 고려하지 않아도 됨. (비편향 추정치이기 때문에 예측값의 분산이 큰 것이지, 예측값 자체에는 편향이 없기 때문!)

     예측을 할 때 중요한 것은 error term을 줄이는 것 뿐임. 

   - 평가

     y값의 범위를 고려하여 mae, mape 등의 적절한 metric을 선정하여야 함. 

     y값이 지나치게 작으면 (1 이하) mape가 200% 등 너무 비대하게 커보일 수 있음. 

     불량 누출을 최소화 할 것인지, 양품 누출을 최소화 할 것인지에 따라 metric을 적절히 고려 해야 함. 

     1. 불량 누출을 최소화 할 때, (순수 불량만을 선별) cutoff 선정 시 불량 recall을 95%로 고정후, accuracy, precision등을 비교. (5% 누출 허용)
     2. 양품 누출을 최소화 할 때, (순수 양품만을 선별) cutoff 선정 시 양품 recall을 95%로 고정후 accuracy precision등을 비교. 



### 알고리즘



